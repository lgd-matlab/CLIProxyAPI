services:
  cli-proxy-api:
    image: eceasy/cli-proxy-api:latest
    restart: unless-stopped

    volumes:
      - type: bind
        source: ./auths
        target: /root/.cli-proxy-api
        is_directory: true

      # IMPORTANT: use a different filename so it doesn't clash with docker-compose.yml
      - type: bind
        source: ./cli-proxy-config.yaml
        target: /CLIProxyAPI/config.yaml
        content: |
          port: 8317
          auth-dir: "~/.cli-proxy-api"
          request-retry: 3
          quota-exceeded:
            switch-project: true
            switch-preview-model: true

          # Management API settings (for /management.html and /v0/management)
          remote-management:
            # allow remote access from your laptop (non-localhost)
            allow-remote: true
            # REQUIRED: if empty, /v0/management is disabled (404)
            secret-key: "CHANGE-THIS-MGMT-KEY"
            # keep the built-in management.html enabled
            disable-control-panel: false
            panel-github-repository: "https://github.com/router-for-me/Cli-Proxy-API-Management-Center"

          api-keys:
            - "ABC-CHANGE-ME-123456"

    expose:
      - "8317"

    # If you already added a Domain in Coolify UI (sslip.io), you can REMOVE labels entirely.
    # (Leaving the placeholder YOUR_DOMAIN.com can create a useless router rule.)
    labels:
      - traefik.enable=true
